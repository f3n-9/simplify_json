# Simplify JSON å·¥å…·ä½¿ç”¨æ–‡æ¡£

## æ¦‚è¿°

Simplify JSON æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºå¤„ç† MinerU è¾“å‡ºçš„ `layout.json` æ–‡ä»¶çš„å·¥å…·ã€‚è¯¥å·¥å…·èƒ½å¤Ÿä»å¤æ‚çš„ PDF å¸ƒå±€åˆ†æç»“æœä¸­æå–çº¯æ–‡æœ¬å†…å®¹ï¼Œå°†å…¶è½¬æ¢ä¸ºé€‚åˆå¤§æ¨¡å‹ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿè¾“å…¥çš„ç®€åŒ–æ ¼å¼ã€‚

MinerU è¾“å‡ºçš„ layout.json æ–‡ä»¶åŒ…å«è¯¦ç»†çš„é¡µé¢å¸ƒå±€ä¿¡æ¯ã€åæ ‡æ•°æ®å’Œå„ç§å…ƒæ•°æ®ï¼Œè€Œ RAG ç³»ç»Ÿé€šå¸¸åªéœ€è¦å…¶ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚æœ¬å·¥å…·é€šè¿‡é€’å½’æå–æ‰€æœ‰ `spans` å­—æ®µä¸­çš„å†…å®¹ï¼Œç”Ÿæˆæ¸…æ´ã€ç»“æ„åŒ–çš„æ–‡æœ¬æ•°æ®ã€‚

## ä¸»è¦åŠŸèƒ½

- ğŸ” **è‡ªåŠ¨æœç´¢**ï¼šé€’å½’æœç´¢æŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰åä¸º `layout.json` çš„æ–‡ä»¶
- ğŸ“ **å†…å®¹æå–**ï¼šä»å¤æ‚çš„ JSON ç»“æ„ä¸­é€’å½’æå–æ‰€æœ‰ `spans` å†…å®¹
- âœ¨ **é¡µç æ³¨å…¥**ï¼šä¸ºæ¯ä¸ªæå–çš„ `span` è‡ªåŠ¨æ·»åŠ æ•´æ•°æ ¼å¼çš„ `page_num` å­—æ®µï¼Œæ ‡æ˜å…¶æ‰€åœ¨çš„é¡µç 
- ğŸ”¢ **é¡µå†…ç´¢å¼•**ï¼šä¸ºæ¯ä¸ª `span` æ·»åŠ ä¸€ä¸ªä»1å¼€å§‹çš„ã€åœ¨**å½“å‰é¡µé¢å†…**å”¯ä¸€çš„ `index`ï¼Œæ–¹ä¾¿åç»­å¤„ç†å’Œæº¯æº
- ğŸ“‚ **çµæ´»è¾“å‡º**ï¼šæ”¯æŒä¸¤ç§è¾“å‡ºæ¨¡å¼ï¼ˆåŸåœ°è¾“å‡º/é›†ä¸­è¾“å‡ºï¼‰
- ğŸš€ **æ‰¹é‡å¤„ç†**ï¼šä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªæ–‡ä»¶
- ğŸ›¡ï¸ **é”™è¯¯å¤„ç†**ï¼šåŒ…å«å¼‚å¸¸å¤„ç†ï¼Œç¡®ä¿å•ä¸ªæ–‡ä»¶é”™è¯¯ä¸å½±å“æ•´ä½“å¤„ç†

## å®‰è£…è¦æ±‚

- Python 3.6+
- æ— éœ€é¢å¤–ä¾èµ–åŒ…ï¼ˆä»…ä½¿ç”¨æ ‡å‡†åº“ï¼‰

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ç”¨æ³•

```python
from simplify_json import simplify_json

# ä½¿ç”¨é»˜è®¤å‚æ•°ï¼ˆé›†ä¸­è¾“å‡ºæ¨¡å¼ï¼‰
simplify_json()

# æŒ‡å®šè¾“å…¥ç›®å½•
simplify_json(input_folder='my_input_folder')

# æŒ‡å®šè¾“å‡ºç›®å½•
simplify_json(output_folder='my_output_folder')
```

### 2. å‘½ä»¤è¡Œä½¿ç”¨

```bash
# ç›´æ¥è¿è¡Œè„šæœ¬ï¼ˆä½¿ç”¨é»˜è®¤å‚æ•°ï¼‰
python simplify_json.py
```

### 3. è¾“å‡ºæ¨¡å¼é€‰æ‹©

#### é›†ä¸­è¾“å‡ºæ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
```python
simplify_json(
    input_folder='input',
    output_to_folder=True,        # é›†ä¸­è¾“å‡º
    output_folder='output'
)
```

#### åŸåœ°è¾“å‡ºæ¨¡å¼
```python
simplify_json(
    input_folder='input',
    output_to_folder=False,       # åŸåœ°è¾“å‡º
    output_folder='output'        # æ­¤å‚æ•°åœ¨åŸåœ°è¾“å‡ºæ¨¡å¼ä¸‹ä¼šè¢«å¿½ç•¥
)
```

## å‚æ•°è¯´æ˜

### `simplify_json()` å‡½æ•°å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼        | è¯´æ˜ |
|------|------|------------|------|
| `input_folder` | str | `'input'`  | è¾“å…¥æ–‡ä»¶å¤¹è·¯å¾„ï¼Œå·¥å…·ä¼šé€’å½’æœç´¢æ­¤ç›®å½•ä¸‹çš„æ‰€æœ‰ `layout.json` æ–‡ä»¶ |
| `output_to_folder` | bool | `True`     | è¾“å‡ºæ¨¡å¼é€‰æ‹©ï¼š<br/>- `True`ï¼šé›†ä¸­è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶å¤¹<br/>- `False`ï¼šåœ¨åŸæ–‡ä»¶åŒç›®å½•ä¸‹è¾“å‡º |
| `output_folder` | str | `'output'` | è¾“å‡ºæ–‡ä»¶å¤¹è·¯å¾„ï¼ˆä»…åœ¨é›†ä¸­è¾“å‡ºæ¨¡å¼ä¸‹æœ‰æ•ˆï¼‰ |

## è¾“å…¥æ–‡ä»¶æ ¼å¼

å·¥å…·å¤„ç†çš„è¾“å…¥æ–‡ä»¶å¿…é¡»å‘½åä¸º `layout.json`ï¼Œæ–‡ä»¶åº”åŒ…å«åµŒå¥—çš„ JSON ç»“æ„ï¼Œå…¶ä¸­åŒ…å« `spans` å­—æ®µã€‚

### ç¤ºä¾‹è¾“å…¥ç»“æ„ï¼š
```json
{
    "pdf_info": [
        {
            "para_blocks": [
                {
                    "type": "title",
                    "bbox": [x1, y1, x2, y2],
                    "lines": [
                        {
                            "bbox": [x1, y1, x2, y2],
                            "spans": [
                                {
                                    "bbox": [x1, y1, x2, y2],
                                    "score": 1.0,
                                    "content": "æ–‡æœ¬å†…å®¹",
                                    "type": "text"
                                }
                            ],
                            "index": 0
                        }
                    ],
                    "index": 0
                }
            ]
        }
    ]
}
```

## è¾“å‡ºæ–‡ä»¶æ ¼å¼

å·¥å…·ä¼šæå–æ‰€æœ‰ `spans` å†…å®¹å¹¶ç”Ÿæˆç®€åŒ–çš„ JSON æ•°ç»„ã€‚æ¯ä¸ª `span` å¯¹è±¡éƒ½ä¼šè¢«æ·»åŠ  `index` å’Œ `page_num` å­—æ®µã€‚

### ç¤ºä¾‹è¾“å‡ºï¼š
```json
[
    {
        "index": 1,
        "bbox": [x1, y1, x2, y2],
        "score": 1.0,
        "content": "æ–‡æœ¬å†…å®¹1",
        "type": "text",
        "page_num": 0
    },
    {
        "index": 2,
        "bbox": [x1, y1, x2, y2],
        "score": 1.0,
        "content": "æ–‡æœ¬å†…å®¹2",
        "type": "text",
        "page_num": 0
    },
    {
        "index": 1,
        "bbox": [x1, y1, x2, y2],
        "score": 1.0,
        "content": "å¦ä¸€é¡µçš„æ–‡æœ¬",
        "type": "text",
        "page_num": 1
    }
]
```

## è¾“å‡ºæ–‡ä»¶å‘½åè§„åˆ™

### é›†ä¸­è¾“å‡ºæ¨¡å¼
- æ–‡ä»¶åæ ¼å¼ï¼š`simplified_layout_{æ–‡ä»¶å¤¹å}.json`
- ç¤ºä¾‹ï¼š
  - `input/doc1/layout.json` â†’ `output/simplified_layout_doc1.json`
  - `input/doc2/layout.json` â†’ `output/simplified_layout_doc2.json`

### åŸåœ°è¾“å‡ºæ¨¡å¼
- æ–‡ä»¶åï¼š`simplified_layout.json`
- ä½ç½®ï¼šä¸åŸ `layout.json` æ–‡ä»¶ç›¸åŒç›®å½•
- ç¤ºä¾‹ï¼š
  - `input/doc1/layout.json` â†’ `input/doc1/simplified_layout.json`

## ç›®å½•ç»“æ„ç¤ºä¾‹

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ simplify_json.py      # ä¸»ç¨‹åºæ–‡ä»¶
â”œâ”€â”€ input/                # è¾“å…¥ç›®å½•
â”‚   â”œâ”€â”€ doc1/
â”‚   â”‚   â””â”€â”€ layout.json
â”‚   â””â”€â”€ doc2/
â”‚       â””â”€â”€ layout.json
â””â”€â”€ output/               # è¾“å‡ºç›®å½•ï¼ˆé›†ä¸­è¾“å‡ºæ¨¡å¼ï¼‰
    â”œâ”€â”€ simplified_layout_doc1.json
    â””â”€â”€ simplified_layout_doc2.json
```

## é”™è¯¯å¤„ç†

- å¦‚æœæŒ‡å®šç›®å½•ä¸­æ²¡æœ‰æ‰¾åˆ° `layout.json` æ–‡ä»¶ï¼Œç¨‹åºä¼šæ˜¾ç¤ºæç¤ºä¿¡æ¯
- å¦‚æœå¤„ç†å•ä¸ªæ–‡ä»¶æ—¶å‡ºç°é”™è¯¯ï¼Œç¨‹åºä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ä½†ç»§ç»­å¤„ç†å…¶ä»–æ–‡ä»¶
- ç¨‹åºä¼šè¿”å›æˆåŠŸå¤„ç†çš„æ–‡ä»¶åˆ—è¡¨

## è¿”å›å€¼

`simplify_json()` å‡½æ•°è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼ŒåŒ…å«æ‰€æœ‰æˆåŠŸå¤„ç†çš„ `layout.json` æ–‡ä»¶è·¯å¾„ã€‚

```python
processed_files = simplify_json()
print(f"æˆåŠŸå¤„ç†äº† {len(processed_files)} ä¸ªæ–‡ä»¶")
```

## å¸¸è§ç”¨ä¾‹

### 1. æ‰¹é‡å¤„ç† PDF è§£æç»“æœ
```python
# å¤„ç† OCR æˆ– PDF è§£æå·¥å…·ç”Ÿæˆçš„å¸ƒå±€æ–‡ä»¶
simplify_json(
    input_folder='pdf_layouts',
    output_to_folder=True,
    output_folder='simplified_results'
)
```

### 2. æ•°æ®é¢„å¤„ç†
```python
# ä¸ºæœºå™¨å­¦ä¹ æˆ–æ–‡æœ¬åˆ†æå‡†å¤‡æ•°æ®
processed = simplify_json(input_folder='raw_data')
print(f"é¢„å¤„ç†å®Œæˆï¼Œå…±å¤„ç† {len(processed)} ä¸ªæ–‡ä»¶")
```

### 3. é›†æˆåˆ°æ•°æ®å¤„ç†ç®¡é“
```python
import os
from simplify_json import simplify_json

def process_pdf_data(source_dir, target_dir):
    """å¤„ç†PDFæ•°æ®çš„å®Œæ•´æµç¨‹"""
    # ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨
    os.makedirs(target_dir, exist_ok=True)

    # ç®€åŒ–JSONæ•°æ®
    processed_files = simplify_json(
        input_folder=source_dir,
        output_to_folder=True,
        output_folder=target_dir
    )

    return processed_files
```

## æ³¨æ„äº‹é¡¹

1. **æ–‡ä»¶ç¼–ç **ï¼šæ‰€æœ‰ JSON æ–‡ä»¶ä½¿ç”¨ UTF-8 ç¼–ç 
2. **æ–‡ä»¶æƒé™**ï¼šç¡®ä¿å¯¹è¾“å…¥ç›®å½•æœ‰è¯»æƒé™ï¼Œå¯¹è¾“å‡ºç›®å½•æœ‰å†™æƒé™
3. **å¤§æ–‡ä»¶å¤„ç†**ï¼šå¯¹äºéå¸¸å¤§çš„ JSON æ–‡ä»¶ï¼Œå¤„ç†å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´
4. **å†…å­˜ä½¿ç”¨**ï¼šå·¥å…·ä¼šå°†æ•´ä¸ª JSON æ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¯·ç¡®ä¿æœ‰è¶³å¤Ÿçš„å†…å­˜

## ç‰ˆæœ¬ä¿¡æ¯

- å½“å‰ç‰ˆæœ¬ï¼š1.0
- Python å…¼å®¹æ€§ï¼š3.6+
- ä¾èµ–ï¼šä»…ä½¿ç”¨ Python æ ‡å‡†åº“

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æ£€æŸ¥ï¼š
1. è¾“å…¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
2. æ–‡ä»¶è·¯å¾„æ˜¯å¦å­˜åœ¨
3. æ˜¯å¦æœ‰è¶³å¤Ÿçš„æ–‡ä»¶æƒé™
4. JSON æ–‡ä»¶æ˜¯å¦æœ‰æ•ˆ
